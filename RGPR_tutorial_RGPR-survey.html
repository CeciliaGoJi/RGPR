<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Emanuel Huber (emanuel.huber@stanford.edu)" />

<meta name="date" content="2016-04-11" />

<title>RGPR tutorial - RGPRsurvey, adding coordinates &amp; processing</title>

<script src="RGPR_tutorial_RGPR-survey_files/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="RGPR_tutorial_RGPR-survey_files/bootstrap-3.3.1/css/journal.min.css" rel="stylesheet" />
<script src="RGPR_tutorial_RGPR-survey_files/bootstrap-3.3.1/js/bootstrap.min.js"></script>
<script src="RGPR_tutorial_RGPR-survey_files/bootstrap-3.3.1/shim/html5shiv.min.js"></script>
<script src="RGPR_tutorial_RGPR-survey_files/bootstrap-3.3.1/shim/respond.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="RGPR_tutorial_RGPR-survey_files/highlight/default.css"
      type="text/css" />
<script src="RGPR_tutorial_RGPR-survey_files/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">


<div id="header">
<h1 class="title">RGPR tutorial - RGPRsurvey, adding coordinates &amp; processing</h1>
<h4 class="author"><em>Emanuel Huber (<a href="mailto:emanuel.huber@stanford.edu">emanuel.huber@stanford.edu</a>)</em></h4>
<h4 class="date"><em>11 April 2016</em></h4>
</div>

<div id="TOC">
<ul>
<li><a href="#objectives-of-this-tutorial"><span class="toc-section-number">1</span> Objectives of this tutorial</a></li>
<li><a href="#preliminary"><span class="toc-section-number">2</span> Preliminary</a><ul>
<li><a href="#file-organisation"><span class="toc-section-number">2.1</span> File organisation</a></li>
<li><a href="#installload-the-necessary-packages"><span class="toc-section-number">2.2</span> Install/load the necessary packages</a></li>
<li><a href="#set-the-working-directory"><span class="toc-section-number">2.3</span> Set the working directory</a></li>
</ul></li>
<li><a href="#read-all-the-gpr-data-in-a-object-of-the-class-gprsurvey"><span class="toc-section-number">3</span> Read all the GPR data in a object of the class <code>GPRsurvey</code></a><ul>
<li><a href="#set-the-filepaths"><span class="toc-section-number">3.1</span> Set the filepaths</a></li>
<li><a href="#create-an-object-of-the-class-gprsurvey"><span class="toc-section-number">3.2</span> Create an object of the class <code>GPRsurvey</code></a></li>
</ul></li>
<li><a href="#add-coordinates"><span class="toc-section-number">4</span> Add coordinates</a><ul>
<li><a href="#option-1-all-the-trace-coordinates-are-already-known"><span class="toc-section-number">4.1</span> Option 1: all the trace coordinates are already known</a></li>
<li><a href="#option-2-some-trace-coordinates-exist"><span class="toc-section-number">4.2</span> Option 2: some trace coordinates exist</a></li>
<li><a href="#setting-the-coordinate-reference-system"><span class="toc-section-number">4.3</span> Setting the coordinate reference system</a></li>
<li><a href="#export-the-coordinates"><span class="toc-section-number">4.4</span> Export the coordinates</a></li>
<li><a href="#remark"><span class="toc-section-number">4.5</span> Remark</a></li>
</ul></li>
<li><a href="#plot-functions"><span class="toc-section-number">5</span> Plot functions</a><ul>
<li><a href="#plot-the-survey"><span class="toc-section-number">5.1</span> Plot the survey</a></li>
<li><a href="#plot-the-gpr-data"><span class="toc-section-number">5.2</span> Plot the GPR data</a></li>
<li><a href="#three-dimensional-plot-of-the-gpr-data"><span class="toc-section-number">5.3</span> Three-dimensional plot of the GPR data</a></li>
<li><a href="#processing-save-and-pdf-export"><span class="toc-section-number">5.4</span> <a name="pookie"></a>Processing, save and PDF export</a></li>
<li><a href="#read-again"><span class="toc-section-number">5.5</span> Read again</a></li>
</ul></li>
</ul>
</div>

<p><code>RGPR</code> is a package for <a href="https://cran.r-project.org/">R</a> to read, write, analyse and visualise ground-penetrating radar (GPR) data.</p>
<blockquote>
<p>R is a [free] programming language and software environment for statistical computing and graphics supported by the R Foundation for Statistical Computing (<a href="https://en.wikipedia.org/wiki/R_%28programming_language%29">Wikipedia &gt; R</a>).</p>
</blockquote>
<p><strong>Note</strong>: This R-package is still in development, and therefore some of the functions may change in a near future. The R-package <code>RGPR</code> is hosted on <a href="https://github.com/">GitHub</a> at <a href="https://github.com/emanuelhuber/RGPR"><a href="https://github.com/emanuelhuber/RGPR" class="uri">https://github.com/emanuelhuber/RGPR</a></a>. You can contribute to the development of <code>RGPR</code>: create an account on <a href="https://github.com/">GitHub</a>, <a href="https://guides.github.com/activities/forking/">fork</a> <code>RGPR</code>, improve it and sumbmit your modifications.</p>
<p>If you have any questions, comments or wishes, etc. feel free to contact me (in english, french or german)</p>
<blockquote>
<p><code>emanuel.huber@stanford.edu</code></p>
</blockquote>
<div id="objectives-of-this-tutorial" class="section level1">
<h1><span class="header-section-number">1</span> Objectives of this tutorial</h1>
<ul>
<li>Learn how to add coordinates to the GPR data.</li>
<li>Learn how to plot the GPR data from your survey all together.</li>
</ul>
<p>However, this tutorial will not explain you the math/algorithms behind the different processing methods.</p>
<p>In this tutorial the code snippets are in monospaced typewriter font like in the following example:</p>
<pre class="r"><code>1 + exp(1:10)</code></pre>
<p>The R output are preceded by a double hash (<code>##</code>). The following R output is from the code snippet above.</p>
<pre><code>##  [1]     3.718282     8.389056    21.085537    55.598150   149.413159
##  [6]   404.428793  1097.633158  2981.957987  8104.083928 22027.465795</code></pre>
<p>Create a text file and save it with the <code>.R</code> extension (the extension for the R-script files). Then copy the code snippets into your R-script file and adapt them to your needs. To run the code in R, copy the code and paste it into the R console. You can also manually enter the code.</p>
<p>Don’t hesitate to consult the help files and to search for help on the internet. For example, to see the help for the function <code>mean()</code>, enter:</p>
<pre class="r"><code>?mean    # open the help file related to the function mean()</code></pre>
</div>
<div id="preliminary" class="section level1">
<h1><span class="header-section-number">2</span> Preliminary</h1>
<ul>
<li>Read the tutorial <a href="http://emanuelhuber.github.io/RGPR/RGPR_tutorial_installation-load.html">RGPR - Getting started (tutorial 1)</a></li>
<li>Read the tutorial <a href="http://emanuelhuber.github.io/RGPR/RGPR_tutorial_basic-processing.html">RGPR - Basic GPR data processing (tutorial 2)</a></li>
<li>Download the data <a href="http://emanuelhuber.github.io/RGPR/2014_04_25_frenke.zip">2014_04_25_frenke.zip</a></li>
</ul>
<div id="file-organisation" class="section level2">
<h2><span class="header-section-number">2.1</span> File organisation</h2>
<p>I recommand you to first think about the organisation of your files and directories. I suggest to organise them as follows:</p>
<pre><code>/2014_04_25_frenke
    /processing      (here you will save the processed GPR files)
    /rawGPR          (the raw GPR data, never modify them!)
    /coord           (coordinates data)
        /FID         (fiducial marker files)
        /FIDmod      (modified fiducial marker files)
        /shapefiles  (here you will export the coordinate shapefiles)
        /topo        (ASCII files containing the trace coordinates)
    measured_coordinates.txt  (the topographic field measurements)
    RGPR_tutorial.R           (this is you R script for this tutorial)</code></pre>
</div>
<div id="installload-the-necessary-packages" class="section level2">
<h2><span class="header-section-number">2.2</span> Install/load the necessary packages</h2>
<p>Load the packages <code>RGPR</code> and <code>rChoiceDialogs</code> (<code>rChoiceDialogs</code> provides a collection of portable choice dialog widgets):</p>
<pre class="r"><code>library(RGPR)   # load RGPR in the current R session
library(rChoiceDialogs)</code></pre>
<p>[optionally] If <code>RGPR</code> is not installed, follow the instructions of the tutorial “Getting started” to install it. [optionally] If R answers you <code>there is no package called 'rChoiceDialogs'</code> you need first to install <code>rChoiceDialogs</code>, either through your R software or directly in R with:</p>
<pre class="r"><code>install.packages(&quot;rChoiceDialogs&quot;)</code></pre>
<p>The warnings that R shows can be ignored.</p>
</div>
<div id="set-the-working-directory" class="section level2">
<h2><span class="header-section-number">2.3</span> Set the working directory</h2>
<p>The working directory must be correctly set to use relative filepath. The working directory can be set either in your R-software or in R directly with (of course you need to change the filepath shown below):</p>
<pre class="r"><code>myDir &lt;- &quot;/home/huber/WORK/UNIBAS/RESEARCH/RGPR/tutorial/2014_04_25_frenke&quot;
setwd(myDir)    # set the working directory
getwd()         # Return the current working directory (just to check)</code></pre>
<pre><code>## [1] &quot;/home/huber/WORK/UNIBAS/RESEARCH/RGPR/tutorial/2014_04_25_frenke&quot;</code></pre>
<p>[optionally] Alternatively, you can use an interactive dialog box from the R-package <code>rChoiceDialogs</code>:</p>
<pre class="r"><code>myDir &lt;- rchoose.dir(default = &quot;/home/huber/WORK/UNIBAS/RESEARCH/RGPR/&quot;)
setwd(myDir)    # set the working directory
getwd()         # Return the current working directory (just to check)</code></pre>
</div>
</div>
<div id="read-all-the-gpr-data-in-a-object-of-the-class-gprsurvey" class="section level1">
<h1><span class="header-section-number">3</span> Read all the GPR data in a object of the class <code>GPRsurvey</code></h1>
<p>An object of the class <code>GPRsurvey</code> is like an index that contains some of the meta-data of several GPR data recorded during one survey. With the class <code>GPRsurvey</code> you have an overview of all your data, you can compute the positions of the profile intersections, plot a top view of the survey and plot the data in 3D with open-GL (implemented in the R-package <code>RGL</code>).</p>
<div id="set-the-filepaths" class="section level2">
<h2><span class="header-section-number">3.1</span> Set the filepaths</h2>
<p>Read all the GPR records (“.DT1”) located in the directory <code>/rawGPR</code> with the exception of the file <code>CMP.DT1</code> and create an object of the class <code>GPRsurvey</code>. To indicate the filepaths of the GPR data to R you have the following options:</p>
<ul>
<li>use a dialogue window</li>
</ul>
<pre class="r"><code># select all the GPR files except CMP.DT1
LINES &lt;- rchoose.files(caption = &quot; DT1 files&quot;,filters = c(&quot;dt1&quot;,&quot;*.dt1&quot;))</code></pre>
<ul>
<li>write manually all the filepath in a list</li>
</ul>
<pre class="r"><code># select all the GPR files except CMP.DT1
LINES &lt;- c()    # initialisation
LINES[1] &lt;- file.path(getwd(), &quot;rawGPR/LINE00.DT1&quot;)
LINES[2] &lt;- file.path(getwd(), &quot;rawGPR/LINE01.DT1&quot;)
LINES[3] &lt;- file.path(getwd(), &quot;rawGPR/LINE02.DT1&quot;)
LINES[4] &lt;- file.path(getwd(), &quot;rawGPR/LINE03.DT1&quot;)
LINES[5] &lt;- file.path(getwd(), &quot;rawGPR/LINE04.DT1&quot;)</code></pre>
<ul>
<li>extract automatically all the GPR file from the directory</li>
</ul>
<pre class="r"><code># list of the filepath
allFilesinDir &lt;- list.files(file.path(getwd(), &quot;rawGPR&quot;))
allFilesinDir</code></pre>
<pre><code>##  [1] &quot;CMP.DT1&quot;    &quot;CMP.GPS&quot;    &quot;CMP.HD&quot;     &quot;LINE00.DT1&quot; &quot;LINE00.GPS&quot;
##  [6] &quot;LINE00.HD&quot;  &quot;LINE01.DT1&quot; &quot;LINE01.GPS&quot; &quot;LINE01.HD&quot;  &quot;LINE02.DT1&quot;
## [11] &quot;LINE02.GPS&quot; &quot;LINE02.HD&quot;  &quot;LINE03.DT1&quot; &quot;LINE03.GPS&quot; &quot;LINE03.HD&quot; 
## [16] &quot;LINE04.DT1&quot; &quot;LINE04.GPS&quot; &quot;LINE04.HD&quot;</code></pre>
<pre class="r"><code># now, select only the file ending with .DT1 and without &quot;CMP&quot; 
# in their names
selDT1 &lt;- grepl(&quot;(.DT1)$&quot;, allFilesinDir, ignore.case = TRUE) &amp; 
          !grepl(&quot;CMP&quot;, allFilesinDir, ignore.case = TRUE)
LINES &lt;- file.path(getwd(), &quot;rawGPR&quot;, allFilesinDir[selDT1])</code></pre>
</div>
<div id="create-an-object-of-the-class-gprsurvey" class="section level2">
<h2><span class="header-section-number">3.2</span> Create an object of the class <code>GPRsurvey</code></h2>
<pre class="r"><code>mySurvey &lt;- GPRsurvey(LINES)</code></pre>
<p>Have a look at the newly created object:</p>
<pre class="r"><code>mySurvey</code></pre>
<pre><code>## *** Class GPRsurvey ***
## Unique directory: /home/huber/WORK/UNIBAS/RESEARCH/RGPR/tutorial/2014_04_25_frenke/rawGPR 
## - - - - - - - - - - - - - - -
##     name length units       date fequency coordinates intersections
## 1 LINE00  55.75     m 2014-04-25      100          NO            NO
## 2 LINE01  11.50     m 2014-04-25      100          NO            NO
## 3 LINE02  68.75     m 2014-04-25      100          NO            NO
## 4 LINE03  90.00     m 2014-04-25      100          NO            NO
## 5 LINE04 111.25     m 2014-04-25      100          NO            NO
## ****************</code></pre>
<p>You can see that no coordinates (x,y,z) are associated with the GPR data. Therefore, if you try to plot the suvey you will get:</p>
<pre class="r"><code>plot(mySurvey, asp=1) # no plot since no coordinates</code></pre>
<pre><code>## Warning in plot.GPRsurvey(mySurvey, asp = 1): no coordinates</code></pre>
<p>Note that the object <code>mySurvey</code> only contains the meta-data and a link to the GPR files (that are stored in your working directory). But <code>mySurvey</code> does not contains the GPR data itself (i.e. the traces). However, we can ask <code>mySurvey</code> to read the data and return it in the form of an object of the class <code>GPR</code>. There are two possibilities:</p>
<ul>
<li>Either subset <code>mySurvey</code> with <code>[[ ]]</code></li>
</ul>
<pre class="r"><code>A02 &lt;- mySurvey[[3]]
A02</code></pre>
<pre><code>## *** Class GPR ***
##  name = LINE02
##  filepath = /home/huber/WORK/UNIBAS/RESEARCH/RGPR/tutorial/2014_04_25_frenke/rawGPR/LINE02.DT1
##  description = 
##  survey date =  2014-04-25 
##  Reflection, 100MHz,Window length=399.6ns, dz=0.4ns
##  275 traces,68.5m long
##  ****************</code></pre>
<ul>
<li>Or get the <code>GPR</code> object with the function <code>getGPR()</code></li>
</ul>
<pre class="r"><code>A02 &lt;- getGPR(mySurvey, id = &quot;LINE02&quot;)
A02</code></pre>
<pre><code>## *** Class GPR ***
##  name = LINE02
##  filepath = /home/huber/WORK/UNIBAS/RESEARCH/RGPR/tutorial/2014_04_25_frenke/rawGPR/LINE02.DT1
##  description = 
##  survey date =  2014-04-25 
##  Reflection, 100MHz,Window length=399.6ns, dz=0.4ns
##  275 traces,68.5m long
##  ****************</code></pre>
<p>You can also directly plot the GPR data with:</p>
<pre class="r"><code># instead of &#39;A02 &lt;- mySurvey[[3]]&#39; and &#39;plot(A02)&#39; do:
plot(mySurvey[[2]]) </code></pre>
<div class="figure">
<img src="RGPR_tutorial_RGPR-survey_files/figure-html/unnamed-chunk-16-1.png" />
</div>
</div>
</div>
<div id="add-coordinates" class="section level1">
<h1><span class="header-section-number">4</span> Add coordinates</h1>
<p>There are two options: (1) either you already have the coordinates of each traces or (2) you have the coordinates of points that were marked in the GPR data using fiducial marker.</p>
<div id="option-1-all-the-trace-coordinates-are-already-known" class="section level2">
<h2><span class="header-section-number">4.1</span> Option 1: all the trace coordinates are already known</h2>
<p>We assume that for each GPR record there is a file containing the (x, y, z) coordinates of every traces. The header of these files is “E”, “N”, “Z” instead of “x”, “y”, “z” because in topography “x” sometimes designates the North (“N”) and not the East (“E”) as we would expect. The designation “E”, “N”, “Z” is less prone to confusion and therefore we chose it!</p>
<ol style="list-style-type: decimal">
<li>Define the filepaths to the topo files:</li>
</ol>
<pre class="r"><code># select all the GPR files except CMP.DT1
TOPO &lt;- c()    # initialisation
TOPO[1] &lt;- file.path(getwd(), &quot;coord/topo/LINE00.txt&quot;)
TOPO[2] &lt;- file.path(getwd(), &quot;coord/topo/LINE01.txt&quot;)
TOPO[3] &lt;- file.path(getwd(), &quot;coord/topo/LINE02.txt&quot;)
TOPO[4] &lt;- file.path(getwd(), &quot;coord/topo/LINE03.txt&quot;)
TOPO[5] &lt;- file.path(getwd(), &quot;coord/topo/LINE04.txt&quot;)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Read all the files with the funciton <code>readTopo()</code> that creates a list whose elements correspond to the GPR record and contain all the trace coordinates:</li>
</ol>
<pre class="r"><code>TOPOList &lt;- readTopo(TOPO, sep = &quot;\t&quot;)</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Set the list of coordinates as the new coordinates to the GPRsurvey object:</li>
</ol>
<pre class="r"><code>coords(mySurvey) &lt;- TOPOList</code></pre>
<pre><code>## Coordinates of the local system: 2622000 1256834 0</code></pre>
</div>
<div id="option-2-some-trace-coordinates-exist" class="section level2">
<h2><span class="header-section-number">4.2</span> Option 2: some trace coordinates exist</h2>
<p>The file <code>coord/measured_coordinates.txt</code> shows some of the surveyed coordinates. The content of the file is shown below.</p>
<pre><code>GPR survey 25 April 2014, Frenkental
Coordinates reference system: CH1903+ / LV95

XLINE00
START 2622172.58, 1256908.26 346.7 
FID1  2622218.98, 1256906.46 345.9
END   2622229.68, 1256905.16 345.9

XLINE01
START 2622233.08, 1256905.76    346 
END     2622244.28, 1256905.16 346

XLINE02
START 2622229.98, 1256905.56 345.9
END   2622226.08, 1256842.96 346.7

XLINE03
START   2622226.08, 1256842.96 346.7
FID1    2622265.48, 1256843.26 344
END     2622269.08, 1256842.96 343.4 

XLINE04
START   2622262.98, 1256834.06 343.8
FID2    2622265.48, 1256843.26 344
END     2622300.41, 1256921.53 343.5 </code></pre>
<p>You observe that the coordinates of the begining and end of each GPR profile are known and that the coordinates of some fiducial markers were also surveyed.</p>
<ol style="list-style-type: decimal">
<li>Now, you have to indicate R to which traces the coordinates correspond. That means, for each GPR data you have to create a file that contains the coordinates with the associated trace number. This is a lot of work. To help you to create these files, use the function <code>exportFid()</code>. This function create for each GPR data a file containing the trace number, position for the start and end positions as well as for the fiducial makers.</li>
</ol>
<pre class="r"><code>exportFid(mySurvey, fPath = file.path(getwd(), &quot;coord/FID/&quot;))</code></pre>
<pre><code>## File &quot;/home/huber/WORK/UNIBAS/RESEARCH/RGPR/tutorial/2014_04_25_frenke/coord/FID/LINE00.txt&quot; created!
## File &quot;/home/huber/WORK/UNIBAS/RESEARCH/RGPR/tutorial/2014_04_25_frenke/coord/FID/LINE01.txt&quot; created!
## File &quot;/home/huber/WORK/UNIBAS/RESEARCH/RGPR/tutorial/2014_04_25_frenke/coord/FID/LINE02.txt&quot; created!
## File &quot;/home/huber/WORK/UNIBAS/RESEARCH/RGPR/tutorial/2014_04_25_frenke/coord/FID/LINE03.txt&quot; created!
## File &quot;/home/huber/WORK/UNIBAS/RESEARCH/RGPR/tutorial/2014_04_25_frenke/coord/FID/LINE04.txt&quot; created!</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Now, add to each FID files three columns corresponding to the trace coordinates. These columns must have as header “N”, “E” and “Z” (for North, East and vertical elevation). Why not “x”, “y” and “z”? Because in topography, “x” defines sometimes the “North”, so it may be confusing…</li>
</ol>
<p>Here is the FID for the GPR data <code>LINE04</code> (<code>coord/FID/LINE04.txt</code>):</p>
<pre><code>TRACE,POSITION,COMMENT
1,0,START
91,22.5,F1
100,24.75,F2
122,30.25,F3
445,111,END</code></pre>
<p>The same file with the three columns added:</p>
<pre><code>TRACE,POSITION,COMMENT,E,N,Z
1,0,START,2622262.98,1256834.06,343.8
100,24.75,F2,2622265.48,1256843.26,344
445,111,END,2622300.41,1256921.53,343.5 </code></pre>
<p>Note that the two lines with the fiducial markers F1 and F3 were removed as no coordinates are available for these markers. Save the modified files in the directory <code>coord/FIDmod</code>.</p>
<ol start="3" style="list-style-type: decimal">
<li>Read the modified fiducial marker files usind the funtion <code>readFID()</code>:</li>
</ol>
<pre class="r"><code>FidFiles &lt;- c()    # initialisation
FidFiles[1] &lt;- file.path(getwd(), &quot;coord/FIDmod/LINE00.txt&quot;)
FidFiles[2] &lt;- file.path(getwd(), &quot;coord/FIDmod/LINE01.txt&quot;)
FidFiles[3] &lt;- file.path(getwd(), &quot;coord/FIDmod/LINE02.txt&quot;)
FidFiles[4] &lt;- file.path(getwd(), &quot;coord/FIDmod/LINE03.txt&quot;)
FidFiles[5] &lt;- file.path(getwd(), &quot;coord/FIDmod/LINE04.txt&quot;)</code></pre>
<pre class="r"><code>FIDs &lt;- readFID(FidFiles)</code></pre>
<pre><code>## read /home/huber/WORK/UNIBAS/RESEARCH/RGPR/tutorial/2014_04_25_frenke/coord/FIDmod/LINE00.txt...
## read /home/huber/WORK/UNIBAS/RESEARCH/RGPR/tutorial/2014_04_25_frenke/coord/FIDmod/LINE01.txt...
## read /home/huber/WORK/UNIBAS/RESEARCH/RGPR/tutorial/2014_04_25_frenke/coord/FIDmod/LINE02.txt...
## read /home/huber/WORK/UNIBAS/RESEARCH/RGPR/tutorial/2014_04_25_frenke/coord/FIDmod/LINE03.txt...
## read /home/huber/WORK/UNIBAS/RESEARCH/RGPR/tutorial/2014_04_25_frenke/coord/FIDmod/LINE04.txt...</code></pre>
<p>If R throw the following error message “Error in readFID(FidFiles) : The headers should be”E“,”N“,”Z“,”TRACE“!” check that the three columns have been added to all the files and that the headers of these columns are correctly set (“N”, “E”, “Z”; the order does not matter).</p>
<ol start="4" style="list-style-type: decimal">
<li>Interpolate the coordinates of the traces for all the GPR profiles according to the modified fiducial marker files. The function <code>interpPos()</code> interpolate the position of the traces from the known trace positions and add the interpolated trace position to the object <code>mySurvey</code>.</li>
</ol>
<pre class="r"><code># interpolating the positions of the traces between the fiducials for each
# GPR-lines and adding the position to the survey.
# + compute the intersection between the GPR-lines
# windows open for checking purposes
# dx should be between 0.1 m and 0.5 m
mySurvey &lt;- interpPos(mySurvey, FIDs) </code></pre>
<pre><code>## LINE00 : mean dx= 0.258   range dx= 0.244 - 0.337
## LINE01 : mean dx= 0.249   range dx= 0.249 - 0.249
## LINE02 : mean dx= 0.229   range dx= 0.229 - 0.229
## LINE03 : mean dx= 0.12   range dx= 0.027 - 0.177
## LINE04 : mean dx= 0.215   range dx= 0.096 - 0.248
## Coordinates of the local system: 2622000 1256834 0</code></pre>
<p>The function <code>interpPos()</code> prints for every GPR record the mean trace spacing as well as the trace spacing range. Normally, these values should be close to the operating settings. In this case, the trace spacing was set equal to <span class="math">\(0.25\,m\)</span> on the field. The trace spacing values for <code>XLINE00</code>, <code>XLINE01</code> and <code>XLINE02</code> looks good. However, the trace spacing for <code>XLINE04</code> and more particularly for <code>XLINE03</code> could be critic (the smallest trace spacing values are very low). You should check and if necessary correct the topographic data…</p>
</div>
<div id="setting-the-coordinate-reference-system" class="section level2">
<h2><span class="header-section-number">4.3</span> Setting the coordinate reference system</h2>
<p>Setting the coordinate reference system is important when exporting the coordinate data in geospatial data format, because it allows the coordinates to be correctly projected in other coordinate reference systems. The topographic data were measured within the new Swiss coordinate system (datum: CH1903+, reference frame: LV95) that can be defined with the code EPSG <span class="math">\(2056\)</span> that corresponds to the new Swiss coordinate system.</p>
<pre class="r"><code>crs(mySurvey) &lt;- &quot;+init=epsg:2056&quot;</code></pre>
</div>
<div id="export-the-coordinates" class="section level2">
<h2><span class="header-section-number">4.4</span> Export the coordinates</h2>
<p>To export the coordinates as shapefiles (one shapefile for all the GPR records), enter:</p>
<pre class="r"><code>exportCoord(mySurvey, fPath=&quot;coord/shapefiles/frenke&quot;)</code></pre>
<p>To export the coordinates as ASCII (<code>.txt</code>) files (on file per GPR record):</p>
<pre class="r"><code>exportCoord(mySurvey, folder=&quot;coord/topo&quot;, type=&quot;ASCII&quot;)</code></pre>
</div>
<div id="remark" class="section level2">
<h2><span class="header-section-number">4.5</span> Remark</h2>
<p>Note that the coordinates are added to the object <code>mySurvey</code> but not to the GPR file. Unless you save the GPR data you will lose the coordinates when you will quit R. To save the GPR data, see [Save, export][].</p>
</div>
</div>
<div id="plot-functions" class="section level1">
<h1><span class="header-section-number">5</span> Plot functions</h1>
<div id="plot-the-survey" class="section level2">
<h2><span class="header-section-number">5.1</span> Plot the survey</h2>
<p>Use the <code>plot()</code> function</p>
<pre class="r"><code>plot(mySurvey)</code></pre>
<p><img src="RGPR_tutorial_RGPR-survey_files/figure-html/unnamed-chunk-27-1.png" /> The red arrows indicate the direction of the survey, the red dots the fiducial markers and the circles the GPR profile intersections.</p>
</div>
<div id="plot-the-gpr-data" class="section level2">
<h2><span class="header-section-number">5.2</span> Plot the GPR data</h2>
<p>To plot the first GPR record, enter:</p>
<pre class="r"><code>plot(mySurvey[[1]], addTopo=TRUE)</code></pre>
<pre><code>## time to depth conversion with constant velocity 0.1</code></pre>
<div class="figure">
<img src="RGPR_tutorial_RGPR-survey_files/figure-html/unnamed-chunk-28-1.png" />
</div>
</div>
<div id="three-dimensional-plot-of-the-gpr-data" class="section level2">
<h2><span class="header-section-number">5.3</span> Three-dimensional plot of the GPR data</h2>
<p>To plot all the GPR records with the topographic information in 3D, enter:</p>
<pre class="r"><code>plot3DRGL(mySurvey, addTopo = TRUE)</code></pre>
<p>Enlarge the window, use the mouse to move the view and zoom in.</p>
</div>
<div id="processing-save-and-pdf-export" class="section level2">
<h2><span class="header-section-number">5.4</span> <a name="pookie"></a>Processing, save and PDF export</h2>
<p>Once you found a satisfactory combination of processing steps, you can apply them all the GPR data. Here is an example</p>
<p>Create a sub-directory in the <code>/processing</code> directory (name it <code>mySurveyProc</code>):</p>
<pre class="r"><code>procDir &lt;- file.path(getwd(), &quot;processing/mySurveyProc/&quot;)
dir.create(file.path(procDir),showWarnings = TRUE)</code></pre>
<pre><code>## Warning in dir.create(file.path(procDir), showWarnings = TRUE): &#39;/home/
## huber/WORK/UNIBAS/RESEARCH/RGPR/tutorial/2014_04_25_frenke/processing/
## mySurveyProc&#39; already exists</code></pre>
<p>Now apply the processing step with a loop to all GPR data indexed by <code>mySurvey</code>:</p>
<pre class="r"><code>for(i in seq_along(mySurvey)){
  A &lt;- mySurvey[[i]]            # get GPR-line no. i
  cat(&quot;processing of line&quot;, name(A),&quot;      &quot;)
  A &lt;- dcshift(A, 1:100)          # DC-shift
  A &lt;- gain(A, type = &quot;power&quot;, alpha = 1, t_end = 200, t_cst = 100)
  A &lt;- fFilter(A, f= c(150, 200), type = &quot;low&quot;, plotSpec = FALSE)
  A &lt;- gain(A, type = &quot;exp&quot;, alpha = 0.1, t_0 = 50, t_end = 180)
  A &lt;- dewow(A, type = &quot;MAD&quot;, w = 50)              # dewow
  A &lt;- filter2D(A, type = &quot;median3x3&quot;)
  # export PDF
 exportPDF(A, clip = 30, fPath = file.path(procDir, name(A)), addTopo = TRUE,
          lwd = 0.5, ws = 1.5)
  # save the processed GPR-line into &quot;.rds&quot; format
  writeGPR(A, fPath = file.path(procDir, paste0(name(A),&quot;.rds&quot;)), 
         format = &quot;rds&quot;, overwrite = TRUE)
  cat(&quot;!\n&quot;)
}</code></pre>
</div>
<div id="read-again" class="section level2">
<h2><span class="header-section-number">5.5</span> Read again</h2>
<p>Next time you can directly load the processed files as follows:</p>
<pre class="r"><code># select all the GPR files except CMP.DT1
procLINES &lt;- c()    # initialisation
procLINES[1] &lt;- file.path(procDir, &quot;LINE00.rds&quot;)
procLINES[2] &lt;- file.path(procDir, &quot;LINE01.rds&quot;)
procLINES[3] &lt;- file.path(procDir, &quot;LINE02.rds&quot;)
procLINES[4] &lt;- file.path(procDir, &quot;LINE03.rds&quot;)
procLINES[5] &lt;- file.path(procDir, &quot;LINE04.rds&quot;)</code></pre>
<pre class="r"><code>procSurvey &lt;- GPRsurvey(procLINES)</code></pre>
<pre><code>## Coordinates of the local system: 2622000 1256834 0</code></pre>
<p>and check the results:</p>
<pre class="r"><code>plot(procSurvey[[1]], addTopo=TRUE)
plot3DRGL(procSurvey, addTopo = TRUE)</code></pre>
<hr />
<p>Notes</p>
<ul>
<li>This document was created with R-markdown and knitr.</li>
</ul>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
