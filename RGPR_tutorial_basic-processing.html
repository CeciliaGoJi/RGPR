<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Emanuel Huber (emanuel.huber@alumni.ethz.ch)" />


<title>RGPR tutorial - Basic GPR data processing</title>

<script src="RGPR_tutorial_basic-processing_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="RGPR_tutorial_basic-processing_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="RGPR_tutorial_basic-processing_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="RGPR_tutorial_basic-processing_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="RGPR_tutorial_basic-processing_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="RGPR_tutorial_basic-processing_files/navigation-1.1/tabsets.js"></script>
<link href="RGPR_tutorial_basic-processing_files/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="RGPR_tutorial_basic-processing_files/highlightjs-1.1/highlight.js"></script>
<header>
  <p><a href="https://emanuelhuber.github.io/RGPR"><img src="home.png"/></a><a href="https://emanuelhuber.github.io/RGPR">back home</a></p>
  <hr/>
</header>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="fluid-row" id="header">



<h1 class="title toc-ignore">RGPR tutorial - Basic GPR data processing</h1>
<h4 class="author"><em>Emanuel Huber (<a href="mailto:emanuel.huber@alumni.ethz.ch">emanuel.huber@alumni.ethz.ch</a>)</em></h4>
<h4 class="date"><em>05 Mai 2018</em></h4>

</div>

<div id="TOC">
<ul>
<li><a href="#objectives-of-this-tutorial"><span class="toc-section-number">1</span> Objectives of this tutorial</a></li>
<li><a href="#preliminary"><span class="toc-section-number">2</span> Preliminary</a><ul>
<li><a href="#file-organisation"><span class="toc-section-number">2.1</span> File organisation</a></li>
<li><a href="#installload-rgpr-and-set-the-working-directory"><span class="toc-section-number">2.2</span> Install/load <code>RGPR</code> and set the working directory</a></li>
</ul></li>
<li><a href="#read-gpr-data"><span class="toc-section-number">3</span> Read GPR data</a></li>
<li><a href="#plot-the-gpr-data"><span class="toc-section-number">4</span> Plot the GPR data</a><ul>
<li><a href="#d-plot-radargramm"><span class="toc-section-number">4.1</span> 2D plot: radargramm</a></li>
<li><a href="#d-plot-trace-plot"><span class="toc-section-number">4.2</span> 1D plot: trace plot</a></li>
<li><a href="#more-infos"><span class="toc-section-number">4.3</span> More infos</a></li>
</ul></li>
<li><a href="#basic-processing-steps"><span class="toc-section-number">5</span> Basic processing steps</a><ul>
<li><a href="#dc-shift-removal"><span class="toc-section-number">5.1</span> DC shift removal</a></li>
<li><a href="#first-wave-break-estimation-and-time-zero-correction"><span class="toc-section-number">5.2</span> First wave break estimation and time-zero correction</a></li>
<li><a href="#dewow"><span class="toc-section-number">5.3</span> Dewow</a></li>
<li><a href="#frequency-filter"><span class="toc-section-number">5.4</span> Frequency filter</a></li>
<li><a href="#time-gain"><span class="toc-section-number">5.5</span> Time gain</a><ul>
<li><a href="#power-gain"><span class="toc-section-number">5.5.1</span> Power gain</a></li>
<li><a href="#exponential-gain"><span class="toc-section-number">5.5.2</span> Exponential gain</a></li>
</ul></li>
<li><a href="#inverse-normal-transformations"><span class="toc-section-number">5.6</span> inverse normal transformations</a></li>
<li><a href="#median-filter-spatial-filter"><span class="toc-section-number">5.7</span> Median filter (spatial filter)</a></li>
<li><a href="#frequency-wavenumber-filter-f-k-filter"><span class="toc-section-number">5.8</span> Frequency-wavenumber filter (f-k-filter)</a></li>
<li><a href="#processing-overview"><span class="toc-section-number">5.9</span> Processing overview</a></li>
<li><a href="#other-processing-functions"><span class="toc-section-number">5.10</span> Other processing functions</a><ul>
<li><a href="#trace-average-removal"><span class="toc-section-number">5.10.1</span> Trace average removal</a></li>
</ul></li>
<li><a href="#save-and-export"><span class="toc-section-number">5.11</span> Save and export</a></li>
<li><a href="#read-the-saved-gpr-data"><span class="toc-section-number">5.12</span> Read the saved GPR data</a></li>
</ul></li>
<li><a href="#some-final-thoughts"><span class="toc-section-number">6</span> Some final thoughts</a></li>
</ul>
</div>

<hr />
<p><code>RGPR</code> is a package for <a href="https://cran.r-project.org/">R</a> to read, write, analyse and visualise ground-penetrating radar (GPR) data.</p>
<p><strong>Note</strong>:</p>
<ul>
<li>This R-package is still in development, and therefore some of the functions may change in a near future.</li>
<li>The R-package <code>RGPR</code> is hosted on <a href="https://github.com/">GitHub</a> at <a href="https://github.com/emanuelhuber/RGPR" class="uri">https://github.com/emanuelhuber/RGPR</a>.</li>
<li>You can contribute to the development of <code>RGPR</code>:
<ol style="list-style-type: decimal">
<li>create an account on <a href="https://github.com/">GitHub</a></li>
<li><a href="https://guides.github.com/activities/forking/">fork</a> <code>RGPR</code></li>
<li>change the code</li>
<li>make a <a href="https://guides.github.com/activities/forking/#making-a-pull-request">pull request</a> (submit your modifications)</li>
</ol></li>
</ul>
<p>If you have any questions, comments or suggestions, feel free to contact me (in english, french or german): <a href="mailto:emanuel.huber@alumni.ethz.ch">emanuel.huber@alumni.ethz.ch</a>.</p>
<div id="objectives-of-this-tutorial" class="section level1">
<h1><span class="header-section-number">1</span> Objectives of this tutorial</h1>
<ul>
<li>Learn some basics of ground-penetrating radar data processing with <code>RGPR</code>.</li>
<li>Learn how to manipulate objects of the class <code>RGPR</code>.</li>
</ul>
<p>Note that his tutorial will not explain you the math/algorithms behind the different processing methods.</p>
<!--
In this tutorial the code snippets are in monospaced typewriter font like in the following example:

```r
1 + exp(1:10)
```

The R output are preceded by a double hash (`##`). The following R output is from the code snippet above.

```
##  [1]     3.718282     8.389056    21.085537    55.598150   149.413159
##  [6]   404.428793  1097.633158  2981.957987  8104.083928 22027.465795
```

Create a text file and save it with the `.R` extension (the extension for the R-script files). Then copy the code snippets into your R-script file and adapt them to your needs. To run the code in R, copy the code and paste it into the R console. You can also manually enter the code.

Don't hesitate to consult the help files and to search for help on the internet. For example, to see the help for the function `mean()`, enter:


```r
?mean    # open the help file related to the function mean()
```
-->
</div>
<div id="preliminary" class="section level1">
<h1><span class="header-section-number">2</span> Preliminary</h1>
<ul>
<li>Download the data <a href="http://emanuelhuber.github.io/RGPR/2014_04_25_frenke.zip">2014_04_25_frenke.zip</a></li>
<li>Unzip the data</li>
</ul>
<div id="file-organisation" class="section level2">
<h2><span class="header-section-number">2.1</span> File organisation</h2>
<p>I suggest to organise your files and directories as follows:</p>
<pre><code>/2014_04_25_frenke   (project directory with date and location)
    /processing      (here you will save the processed GPR files)
    /rawGPR          (the raw GPR data, never modify them!)
    RGPR_tutorial.R  (this is you R script for this tutorial)</code></pre>
</div>
<div id="installload-rgpr-and-set-the-working-directory" class="section level2">
<h2><span class="header-section-number">2.2</span> Install/load <code>RGPR</code> and set the working directory</h2>
<ul>
<li><p>Install and load the <code>RGPR</code>-package</p>
<pre class="r"><code># install &quot;devtools&quot; if not already done
if(!require(&quot;devtools&quot;)) install.packages(&quot;devtools&quot;)
devtools::install_github(&quot;emanuelhuber/RGPR&quot;)
library(RGPR)       # load RGPR in the current R session</code></pre></li>
<li><p>Set the working directory:</p>
<pre class="r"><code>myDir &lt;- &quot;~/2014_04_25_frenke&quot;  # adapt that to your directory structure
setwd(myDir)    # set the working directory
getwd()         # Return the current working directory (just to check)</code></pre></li>
</ul>
</div>
</div>
<div id="read-gpr-data" class="section level1">
<h1><span class="header-section-number">3</span> Read GPR data</h1>
<p>The raw GPR data are located in the directory <code>/rawGPR</code>. The data format is the Sensors &amp; Software format. Each GPR data consists of</p>
<ul>
<li>a header file (extension <code>.hd</code>) that can be opened with a normal text editor</li>
<li>a binary data file (extension <code>.DT1</code>).</li>
</ul>
<p>To read the GPR data, enter</p>
<pre class="r"><code>A &lt;- readGPR(fPath = &quot;rawGPR/LINE00.DT1&quot;)   # the filepath is case sensitive!
class(A)</code></pre>
<pre><code>## [1] &quot;GPR&quot;
## attr(,&quot;package&quot;)
## [1] &quot;RGPR&quot;</code></pre>
</div>
<div id="plot-the-gpr-data" class="section level1">
<h1><span class="header-section-number">4</span> Plot the GPR data</h1>
<div id="d-plot-radargramm" class="section level2">
<h2><span class="header-section-number">4.1</span> 2D plot: radargramm</h2>
<p>To plot the GPR record as a raster image (default mode), enter</p>
<pre class="r"><code>plot(A)                                 </code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-7-1.png" /><!-- --></p>
<p>The green line indicates the position of time-zero. The yellow triangle indicates the position of a fiducial marker that was set during the survey to mark something (such as a specific object close to the GPR line, a change in morphology/topography/sedimentology or an intersection with another GPR line). These markers are very useful to add topographic data to the GPR profile, particularly when the fiducial markers correspond to the locations where the (x,y,z) coordinates were measured.</p>
<p>Plot wiggles</p>
<pre class="r"><code>plot(A, type = &quot;wiggles&quot;)          </code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-8-1.png" /><!-- --></p>
<p>To plot only a part of the GPR data, use <code>xlim</code> and <code>ylim</code>.</p>
<pre class="r"><code>plot(A, ylim = c(50, 100), xlim = c(30, 40))</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-9-1.png" /><!-- --></p>
<p>To set the origin of the vertical axis at time-zero, set the argument <code>relTime0</code> equal to <code>TRUE</code>.</p>
<pre class="r"><code>plot(A, relTime0 = TRUE, ylim = c(0, 200), xlim = c(30, 50))</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-10-1.png" /><!-- --></p>
<p>Another way to plot only a part of the GPR data is to extract a part of the GPR data. The object <code>A</code> can be manipulated in the same way as a matrix without losing the meta-data (e.g., trace coordinates, antenna separation).</p>
<p>To extract the samples 100 to 300 of the 15<span class="math inline">\(^{th}\)</span> to 150<span class="math inline">\(^{th}\)</span>:</p>
<pre class="r"><code># extract the 100 to 300 samples of the traces 15 to 150
A0 &lt;- A[100:300, 15:150]  
A</code></pre>
<pre><code>## *** Class GPR ***
##  name        = LINE00
##  filepath    = rawGPR/LINE00.DT1
##  1 fiducial(s)
##  description = 
##  survey date = 2014-04-25
##  Reflection, 100 MHz, Window length = 399.6 ns, dz = 0.4 ns
##  223 traces, 55.5 m
##  ****************</code></pre>
<pre class="r"><code>A0</code></pre>
<pre><code>## *** Class GPR ***
##  name        = LINE00
##  filepath    = rawGPR/LINE00.DT1
##  description = 
##  survey date = 2014-04-25
##  Reflection, 100 MHz, Window length = 80 ns, dz = 0.4 ns
##  136 traces, 33.75 m
##  ****************</code></pre>
<p>Check the depth/time and positions values</p>
<pre class="r"><code>depth(A)     
pos(A)</code></pre>
<p>Plot a section/subset of the GPR record (like zooming)</p>
<pre class="r"><code># plot the 100 to 300 samples of the traces 15 to 150
plot(A[100:300, 15:150])        </code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-13-1.png" /><!-- --></p>
</div>
<div id="d-plot-trace-plot" class="section level2">
<h2><span class="header-section-number">4.2</span> 1D plot: trace plot</h2>
<p>Plot a signal trace, notice that the signal is clipped to <span class="math inline">\(\pm50\,mV\)</span> (between <span class="math inline">\(0\)</span> and <span class="math inline">\(20\,ns\)</span>):</p>
<pre class="r"><code>plot(A[, 15])      # plot the 15th trace of the GPR-line   </code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-14-1.png" /><!-- --></p>
<p>Note: the <code>@3.5m</code> in the plot title indicate the relative position of the trace on the GPR profile.</p>
<p>Plot the first 40 trace samples:</p>
<pre class="r"><code># plot the first 40 samples of the 15th trace of the GPR profile
plot(A[1:40, 15])  </code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-15-1.png" /><!-- --></p>
</div>
<div id="more-infos" class="section level2">
<h2><span class="header-section-number">4.3</span> More infos</h2>
<p>Check the help for more details on the <code>plot()</code> function:</p>
<pre class="r"><code>?plot.GPR</code></pre>
</div>
</div>
<div id="basic-processing-steps" class="section level1">
<h1><span class="header-section-number">5</span> Basic processing steps</h1>
<div id="dc-shift-removal" class="section level2">
<h2><span class="header-section-number">5.1</span> DC shift removal</h2>
<p>Plot a single trace:</p>
<pre class="r"><code>plot(A[, 15])  # plot the 15th trace of the GPR-line</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-17-1.png" /><!-- --></p>
<p>Notice how the trace samples before the first wave arrival (before <span class="math inline">\(t = 0\,ns\)</span>) are slightly shifted below <span class="math inline">\(0\,mV\)</span>? This shift is called direct current offset (DC-offset) and you will remove it from the data. The direct current offset is estimated on trace samples before time-zero.</p>
<ol style="list-style-type: decimal">
<li>Determine which samples will be used to estimate the direct current offset (i.e., the samples before the first wave arrival). Identify the samples before <span class="math inline">\(t = 0\,ns\)</span> by ploting the first n samples of the traces. For example, for <span class="math inline">\(n = 110\)</span>:</li>
</ol>
<pre class="r"><code># plot the first 110 samples of the 15th trace of the GPR profile
plot(A[1:110, 15]) </code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-18-1.png" /><!-- --></p>
<ol start="2" style="list-style-type: decimal">
<li>Remove the DC-offset estimated on the first n samples usind the function <code>dcshift()</code>. This function takes as argument the <code>GPR</code> object and the sample index used to estimate the DC shift (in this case, the first <span class="math inline">\(110\)</span> samples):</li>
</ol>
<pre class="r"><code>A1 &lt;- dcshift(A, 1:110)   # new object A1 </code></pre>
<p>You can visualise the DC-offset on the trace plot by adding an horizontal lines (<code>abline(h=...)</code>) with the argument <code>h</code> equal the DC-offset, i.e., the mean of the first <span class="math inline">\(110\)</span> samples (<code>mean(A[1:110,15]</code>):</p>
<pre class="r"><code>{plot(A[, 15])  # plot the 15th trace of the GPR-line 
# add a green horizontal line
abline(h = mean(A[1:110, 15]), col = &quot;green&quot;) }</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-20-1.png" /><!-- --></p>
<p>Have a look at A1:</p>
<pre class="r"><code>A1</code></pre>
<pre><code>## *** Class GPR ***
##  name        = LINE00
##  filepath    = rawGPR/LINE00.DT1
##  1 fiducial(s)
##  description = 
##  survey date = 2014-04-25
##  Reflection, 100 MHz, Window length = 399.6 ns, dz = 0.4 ns
##  223 traces, 55.5 m
##  ****************</code></pre>
<p>Compared with <code>A</code> or <code>print(A)</code>, two additional lines are displayed. The second line shows the applied processing step, <code>dcshift</code>, with the arguments passed to the function. Each time a GPR object is processed with a function, the name of the function as well as some of its arguments are stored in the GPR object. This enables to track the data processing, i.e., to know exactly which processing steps where applied to the data. This is a first step toward reproducible research.</p>
<p>The processing steps can be extracted with the function <code>processing()</code>:</p>
<pre class="r"><code>proc(A1)</code></pre>
<pre><code>## character(0)</code></pre>
</div>
<div id="first-wave-break-estimation-and-time-zero-correction" class="section level2">
<h2><span class="header-section-number">5.2</span> First wave break estimation and time-zero correction</h2>
<p>Here, we define time-zero, <span class="math inline">\(t_0\)</span> as the time at which the transmitter starts to emit the wave.</p>
<p>Maybe is time-zero not correctly set. To get the time-zero for each traces of <code>A1</code> use the function <code>time0()</code>:</p>
<pre class="r"><code>time0(A1)</code></pre>
<p>The first wave break, <span class="math inline">\(t_{\mathrm{fb}}\)</span>, is estimated for each traces (it is the time of the first wave record)</p>
<pre class="r"><code>tfb &lt;- firstBreak(A1)   # take some time
plot(pos(A1), tfb, pch = 20, ylab = &quot;first wave break&quot;, 
     xlab = &quot;position (m)&quot;)</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-24-1.png" /><!-- --></p>
<p>Convert the first wave break time <span class="math inline">\(t_{\mathrm{fb}}\)</span> into time-zero <span class="math inline">\(t_0\)</span> with <code>firstBreakToTime0()</code>.</p>
<p>Here we define <span class="math inline">\(t_0 = t_{\mathrm{fb}} - a/c_0\)</span>, where <span class="math inline">\(a\)</span> is the distance between the transmitter and receiver and <span class="math inline">\(c_0\)</span> is the wave velocity in the media between the transmitter and receiver (in our case, air). The value <span class="math inline">\(a/c_0\)</span> corresponds to the wave travel time from the transmitter to the receiver.</p>
<pre class="r"><code>t0 &lt;- firstBreakToTime0(tfb, A1)
time0(A1) &lt;- t0     # set time0 to A1</code></pre>
<p>Note that if <code>t0</code> is too noisy, you can set <code>time0(A1) &lt;- mean(t0)</code>.</p>
<p>Check the results (do you see the difference between time-zero in red and first wave break time in blue?):</p>
<pre class="r"><code>plot(A1[, 15])  # plot the 15th trace of the GPR-line
abline(v = tfb[15], col = &quot;blue&quot;)  # first wave break time</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-26-1.png" /><!-- --></p>
<p>To shift the traces to time-zero, use the function <code>time0Cor</code> (the <code>method</code> argument defines the type of interpolation method)</p>
<pre class="r"><code>A2 &lt;- time0Cor(A1, method = &quot;pchip&quot;)</code></pre>
<pre class="r"><code>plot(A2)</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-28-1.png" /><!-- --></p>
</div>
<div id="dewow" class="section level2">
<h2><span class="header-section-number">5.3</span> Dewow</h2>
<p>Remove the low-frequency components (the so-called “wow”) of the GPR record using:</p>
<ol style="list-style-type: decimal">
<li>either a median absolute deviation (MAD) filter (<code>type = &quot;MAD&quot;</code>).</li>
<li>or a Gaussian filter (<code>type = &quot;Gaussian&quot;</code>). The Gaussian filter is faster than the MAD filter.</li>
</ol>
<p>In both cases, the argument <code>w</code> is the length of the filter in time units.</p>
<pre class="r"><code>A3 &lt;- dewow(A2, type = &quot;MAD&quot;, w = 50)     # dewowing: take some time
plot(A3)                                  # plot the result</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-29-1.png" /><!-- --></p>
<p>Can you see the difference with <code>A1</code>? Plot <code>A2 - A1</code> to see the removed “wow”.</p>
<pre class="r"><code>plot(A3 - A2)                           # plot the difference</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-30-1.png" /><!-- --></p>
<p>See the dewowing by comparing the traces before (blue line) and after (red line):</p>
<pre class="r"><code>plot(A2[,15], col = &quot;blue&quot;)      # before dewowing
lines(A3[,15], col = &quot;red&quot;)      # after dewowing</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-31-1.png" /><!-- --></p>
</div>
<div id="frequency-filter" class="section level2">
<h2><span class="header-section-number">5.4</span> Frequency filter</h2>
<p>Let’s have a look at the amplitude-frequency and phase-frequency plot (the spectrum given by the Fourier decomposition):</p>
<pre class="r"><code>spec(A3)</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-32-1.png" /><!-- --></p>
<p>The curve in red is the averaged amplitude/phase over all the trace amplitudes/phases.</p>
<p>On the first plot, notice</p>
<ul>
<li>a sharp increase of the amplitude between <span class="math inline">\(0\,\mathit{MHz}\)</span> and <span class="math inline">\(10\,\mathit{MHz}\)</span>: these frequency correspond to the slowing-varying part of the signal. In this particular case, filtering out this part of the signal results in strong signal distorsion.</li>
<li>after a peak at <span class="math inline">\(80\,\mathit{MHz}\)</span> (the returned signal frequency that is lower than the antenna frequency because of frequency-dependent attenuation in the ground), the amplitude decreases.</li>
<li>at about <span class="math inline">\(200\,\mathit{MHz}\)</span> the amplitude stays constant (plateau): noise frequency.</li>
</ul>
<p>Eliminate the high-frequency (noise) component of the GPR record with a bandpass filter. We define as corner frequencies at <span class="math inline">\(150\,\mathit{MHz}\)</span> and <span class="math inline">\(260\,\mathit{MHz}\)</span>, and set <code>plotSpec = TRUE</code> to plot the spectrum with the signal, the filtered signal and the filter.</p>
<pre class="r"><code>A4 &lt;- fFilter(A3, f = c(150, 260), type = &quot;low&quot;, plotSpec = TRUE)</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-33-1.png" /><!-- --></p>
<pre class="r"><code>plot(A4)</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-33-2.png" /><!-- --></p>
<p>Let see the difference</p>
<pre class="r"><code>plot(A4 - A3, clip = 50)</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-34-1.png" /><!-- --></p>
<p>Ideally, the objective of processing is to remove the noise component without altering the signal component to improve the signal/noise ratio. When ploting the difference in processing (after - before), one should only observe the noise that is filtered out. Here, removing and attenuating some frequencies change the signal amplitude.</p>
</div>
<div id="time-gain" class="section level2">
<h2><span class="header-section-number">5.5</span> Time gain</h2>
<p>Apply a gain to compensate the signal attenuation. Three types of gain are available:</p>
<ul>
<li>power gain (<code>type = &quot;power&quot;</code>): <span class="math inline">\(A_g(t) = A(t)\cdot t^\alpha \)</span> with <span class="math inline">\(\alpha = 1 \)</span> per default.</li>
<li>exponential gain (<code>type = &quot;exp&quot;</code>): <span class="math inline">\(A_g(t) = A(t)\cdot \exp(\alpha \cdot t)\)</span>.</li>
<li>Automatic gain control (<code>type = &quot;agc&quot;</code>): make gain equal to the local root mean squared signal.</li>
</ul>
<p>We will first apply a power gain and then an exponential gain. To visualise the amplitude of the GPR signal as a function of time, use the function <code>plotAmpl()</code> as follows:</p>
<pre class="r"><code>plotAmpl(A4, col = &quot;black&quot;)          # plot amplitude as a function of time</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-35-1.png" /><!-- --></p>
<p>On the previous plot, there is a sharp amplitude increase at about <span class="math inline">\(20\,ns\)</span> corresponding to the first wave arrival. Then the amplitude decreases until a plateau at about <span class="math inline">\(200\,ns\)</span>. This plateau corresponds to the signal noise. There is little hope to extract some useful information above <span class="math inline">\(150\,ns\)</span> because above <span class="math inline">\(150\,ns\)</span> the signal/noise ratio is much smaller than <span class="math inline">\(1\)</span> (i.e., more noise than signal).</p>
<div id="power-gain" class="section level3">
<h3><span class="header-section-number">5.5.1</span> Power gain</h3>
<p>The power gain is set constant until <code>tcst = 100</code> ns and applied from <span class="math inline">\(100\,ns\)</span> to <code>te = 200</code> ns, with <span class="math inline">\(\alpha = 1\)</span>.</p>
<pre class="r"><code>A5 &lt;- gain(A4, type = &quot;power&quot;, alpha = 1, te = 150, tcst = 20)</code></pre>
<p>Compare the amplitude before and after the power gain:</p>
<pre class="r"><code>plotAmpl(A4, col = &quot;black&quot;)   
# set add=TRUE to add the amplitude on the previous plot
plotAmpl(A5, col = &quot;red&quot;, add = TRUE)</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-37-1.png" /><!-- --></p>
<pre class="r"><code>plot(A5)      # how does it look after the gain?</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-37-2.png" /><!-- --></p>
</div>
<div id="exponential-gain" class="section level3">
<h3><span class="header-section-number">5.5.2</span> Exponential gain</h3>
<p>Ideally, the parameter <span class="math inline">\(\alpha\)</span> in the exponential gain should be close to the slope of the amplitude decrease. This slope could be estimated by fitting a straight line to the amplitude decrease. We only want to apply the filter between <span class="math inline">\(0\,\mathit{ns}\)</span> (<code>t0</code>) and <span class="math inline">\(125\,\mathit{ns}\)</span> (<code>te</code> for <span class="math inline">\(t_\mathit{end}\)</span> ):</p>
<pre class="r"><code>A6 &lt;- gain(A5, type =&quot;exp&quot;,  alpha = 0.2, t0 = 0, te = 125)
plotAmpl(A6, col = &quot;green&quot;)</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-38-1.png" /><!-- --></p>
<p>Oops! Set <code>alpha</code> to a smaller value!</p>
<pre class="r"><code>A6 &lt;- gain(A5, type = &quot;exp&quot;, alpha = 0.11, t0 = 0, te = 125)
plotAmpl(A4, col = &quot;black&quot;) 
plotAmpl(A5, col = &quot;red&quot;, add = TRUE) 
plotAmpl(A6, col = &quot;green&quot;, add = TRUE)</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-39-1.png" /><!-- --></p>
<pre class="r"><code>plot(A6)    # how does it look after the gain?</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-39-2.png" /><!-- --></p>
<p>Plot the gained GPR record and clip the amplitude values to <span class="math inline">\(50\,\mathit{mV}\)</span> using the argument <code>clip</code>:</p>
<pre class="r"><code>plot(A6, clip = 50)    # how does it look after the gain?</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-40-1.png" /><!-- --></p>
</div>
</div>
<div id="inverse-normal-transformations" class="section level2">
<h2><span class="header-section-number">5.6</span> inverse normal transformations</h2>
<p>Have a look at the histogram of the values of <code>A6</code></p>
<pre class="r"><code>hist(A6[], breaks = 50)</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-41-1.png" /><!-- --></p>
<p>This histogram is very narrow, meaning that a lot of values are very close to zero and therefore many details are not really visible. To widen this histogram, we can transform it to make it more normally distributed with a rank-based inverse normal transformation:</p>
<pre class="r"><code>A7 &lt;- traceScaling(A6, type = &quot;invNormal&quot;)</code></pre>
<p>Histograms before and after</p>
<pre class="r"><code>par(mfrow = c(1, 2))
hist(A6[], breaks = 50)
hist(A7[], breaks = 50)</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-43-1.png" /><!-- --> Have a look at the results of the transformation:</p>
<pre class="r"><code>plot(A7)</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-44-1.png" /><!-- --></p>
</div>
<div id="median-filter-spatial-filter" class="section level2">
<h2><span class="header-section-number">5.7</span> Median filter (spatial filter)</h2>
<p>A non-linear filter to remove noise:</p>
<pre class="r"><code>A8 &lt;- filter2D(A7, type = &quot;median3x3&quot;)
plot(A8)</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-45-1.png" /><!-- --></p>
<p>Let see the difference</p>
<pre class="r"><code>plot(A8 - A7)</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-46-1.png" /><!-- --></p>
</div>
<div id="frequency-wavenumber-filter-f-k-filter" class="section level2">
<h2><span class="header-section-number">5.8</span> Frequency-wavenumber filter (f-k-filter)</h2>
<p>The function <code>spec()</code> with the argument <code>type = &quot;f-k</code> returns a list containing the frequencies (f), the wavenumbers (k), the amplitude of the GPR data.</p>
<pre class="r"><code>FKSpec &lt;- spec(A8, type = &quot;f-k&quot;)
area &lt;- list(x = c(0, min(FKSpec$wnb), min(FKSpec$wnb), max(FKSpec$wnb), max(FKSpec$wnb), 0),
             y = c(max(FKSpec$fre), 800, 0, 0, 800, max(FKSpec$fre) ))
lines(area, type=&quot;o&quot;)</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-47-1.png" /><!-- --></p>
<pre class="r"><code>A9 &lt;- fkFilter(A8, fk = area)</code></pre>
<p>With the f-k-filter you can successfully remove the artifacts but still the information gained is very small in this case (the quality of the raw GPR data is already bad):</p>
<pre class="r"><code>plot(A9, clip = 50)</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-48-1.png" /><!-- --></p>
<pre class="r"><code>spec(A9, type = &quot;f-k&quot;)</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-48-2.png" /><!-- --></p>
<p>Let see the difference</p>
<pre class="r"><code>plot(A9 - A8)</code></pre>
<p><img src="RGPR_tutorial_basic-processing_files/figure-html/unnamed-chunk-49-1.png" /><!-- --></p>
</div>
<div id="processing-overview" class="section level2">
<h2><span class="header-section-number">5.9</span> Processing overview</h2>
<p>Let review the processing step applied on the GPR record:</p>
<pre class="r"><code>proc(A9)</code></pre>
<pre><code>## [1] &quot;time0&lt;-&quot;</code></pre>
</div>
<div id="other-processing-functions" class="section level2">
<h2><span class="header-section-number">5.10</span> Other processing functions</h2>
<div id="trace-average-removal" class="section level3">
<h3><span class="header-section-number">5.10.1</span> Trace average removal</h3>
<p>Check the help page for the function <code>traceAverage</code></p>
<pre class="r"><code>?traceAverage</code></pre>
</div>
</div>
<div id="save-and-export" class="section level2">
<h2><span class="header-section-number">5.11</span> Save and export</h2>
<p>Save the processed GPR record into the directory /processing. Use the <code>.rds</code> format (this is a R internal format)</p>
<pre class="r"><code>writeGPR(A9, fPath = file.path(getwd(), &quot;processing&quot;, paste0(name(A9), &quot;.rds&quot;)), 
         format = &quot;rds&quot;, overwrite = TRUE)</code></pre>
<pre><code>## *** Class GPR ***
##  name        = LINE00
##  filepath    = /media/huber/Elements/UNIBAS/software/codeR/package_RGPR/RGPR-gh-pages/2014_04_25_frenke/processing/LINE00.dt1
##  1 fiducial(s)
##  description = 
##  survey date = 2014-04-25
##  Reflection, 100 MHz, Window length = 352 ns, dz = 0.4 ns
##  223 traces, 55.5 m
##  &gt; PROCESSING
##    1. time0&lt;-
##  ****************</code></pre>
<p>Export a high quality PDF:</p>
<pre class="r"><code>plot(A9, type = &quot;wiggles&quot;, clip = 30, pdfName = file.path(getwd(), &quot;processing&quot;, name(A9)),
          lwd = 0.5, wsize = 2.5)</code></pre>
</div>
<div id="read-the-saved-gpr-data" class="section level2">
<h2><span class="header-section-number">5.12</span> Read the saved GPR data</h2>
<pre class="r"><code>procA &lt;- readGPR(fPath = file.path(getwd(), &quot;processing&quot;, paste0(name(A9), &quot;.rds&quot;))) </code></pre>
</div>
</div>
<div id="some-final-thoughts" class="section level1">
<h1><span class="header-section-number">6</span> Some final thoughts</h1>
<p>Warning: processing can introduce artifacts in the data and lead to false interpreations.</p>
<hr />
<blockquote>
<p>What really matters is that the final interpretation is valid, and although processing is important, ultimately, the key to good data interpretation is good data collection in the first place.<br />
<em>in Cassidy (2009) Chapter 5 - Ground Penetrating Radar Data Processing, Modelling and Analysis, In Ground Penetrating Radar Theory and Applications, (Eds Harry M. Jol,), Elsevier, Amsterdam, pp: 141-176, ISBN 9780444533487</em>.</p>
</blockquote>
<hr />
<blockquote>
<p>A good practical mantra for most users to adopt is if it cannot be seen in the raw data – is it really there? As such, processing steps should be used to improve the raw-data quality, therefore, making interpretation easier. In practice, this means increasing the signal-to-noise ratio of coherent responses and presenting the data in a format that reflects the subsurface conditions accurately.<br />
<em>in Cassidy (2009) Chapter 5 - Ground Penetrating Radar Data Processing, Modelling and Analysis, In Ground Penetrating Radar Theory and Applications, (Eds Harry M. Jol,), Elsevier, Amsterdam, pp: 141-176, ISBN 9780444533487</em>.</p>
</blockquote>
<hr />
<blockquote>
<p>Processing of GPR data tends to improve the appearance of data, but rarely does processing substantially change the interpretation.<br />
<em>in Daniels et al. (1997) Coincident Antenna Three-Dimensional GPR. Journal of Environmental and Engineering Geophysics, Vol. 2, No.1, pp. 1–9</em>.</p>
</blockquote>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
